# ğŸ“ GUIA VISUAL: Aplicar CorreÃ§Ã£o do Desconto no Supabase

## Onde estÃ¡ o problema?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Cria fatura com desconto      â”‚
â”‚ desconto = 100, tipoDesconto = 'fixed'  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API: Envia para banco de dados          â”‚
â”‚ p_fatura: { desconto: 100, ... }        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ FUNÃ‡ÃƒO ANTIGA (BUGADA):              â”‚
â”‚ Recebe desconto MAS ignora!             â”‚
â”‚ NÃ£o registra na tabela faturas          â”‚
â”‚ NÃ£o calcula em totais_fatura            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Resultado:** Desconto desaparece! ğŸ˜

---

## Como corrigir?

### ğŸ“± Interface do Supabase

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ  Supabase Dashboard                      â”‚
â”‚                                             â”‚
â”‚ â”œâ”€ ğŸ“Š Table Editor        â† NÃƒO USAR      â”‚
â”‚ â”œâ”€ ğŸ”‘ Authentication                       â”‚
â”‚ â”œâ”€ ğŸ”— Realtime                             â”‚
â”‚ â”œâ”€ ğŸ“ Storage                              â”‚
â”‚ â”œâ”€ ğŸ› ï¸ SQL Editor           â† CLICAR AQUI! â”‚
â”‚ â”œâ”€ ğŸ”Œ API & Extensions                     â”‚
â”‚ â””â”€ âš™ï¸ Settings                             â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¯ Passo a Passo Visual

```
PASSO 1: Abrir SQL Editor
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase â†’ SQL Editor               â”‚
â”‚           â†“ (lado esquerdo)         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚    â”‚ SQL Editor  â”‚  â† Clique aqui   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASSO 2: Nova Query
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [+ New Query] â† BotÃ£o azul, topo   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASSO 3: Copiar CÃ³digo
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Abra: fix_desconto_db.sql            â”‚
â”‚ Selecione: Ctrl+A (tudo)             â”‚
â”‚ Copie: Ctrl+C                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASSO 4: Colar no Editor
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ SELECT * FROM tabelas;           â”‚ â”‚ â† Editor
â”‚ â”‚ â† Cole o SQL aqui (Ctrl+V)       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASSO 5: Executar
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ [RUN]  â† BotÃ£o azul, canto sup  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PASSO 6: Verificar Resultado
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Status: SUCCESS                   â”‚
â”‚                                      â”‚
â”‚ Mensagem:                            â”‚
â”‚ "FunÃ§Ã£o criar_fatura_completa        â”‚
â”‚  atualizada com suporte a desconto!" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¹ SequÃªncia de Cliques

```
1ï¸âƒ£  Dashboard Supabase
    â””â”€â†’ 2ï¸âƒ£  Menu esquerdo: "SQL Editor"
        â””â”€â†’ 3ï¸âƒ£  BotÃ£o "+ New Query"
            â””â”€â†’ 4ï¸âƒ£  Arquivo abre em editor
                â””â”€â†’ 5ï¸âƒ£  Cola o SQL (Ctrl+V)
                    â””â”€â†’ 6ï¸âƒ£  Clica botÃ£o [RUN]
                        â””â”€â†’ 7ï¸âƒ£  âœ… PRONTO!
```

---

## ğŸ” VerificaÃ§Ã£o Visual

ApÃ³s clicar RUN, vocÃª verÃ¡:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query Results                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… status                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ FunÃ§Ã£o criar_fatura_completa         â”‚  â”‚
â”‚ â”‚ atualizada com suporte a desconto!   â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Se vir isso = âœ… SUCESSO!**

---

## ğŸ§ª Teste Depois

Para confirmar que funcionou:

### Query de Teste:
```sql
-- Execute esta query para confirmar

SELECT 
    id,
    numero,
    desconto,
    tipo_desconto,
    (SELECT total_final FROM totais_fatura 
     WHERE fatura_id = faturas.id) as total_final
FROM faturas
WHERE desconto > 0
ORDER BY created_at DESC
LIMIT 1;
```

### Resultado Esperado:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id       â”‚ FTR_0001                    â”‚
â”‚ numero   â”‚ FTR_0001                    â”‚
â”‚ desconto â”‚ 100                         â”‚
â”‚ tipo_desconto â”‚ fixed                  â”‚
â”‚ total_final   â”‚ 900 (1000 - 100)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Se vir assim = âœ… DESCONTO AGORA ESTÃ SENDO REGISTRADO!

---

## âš ï¸ PossÃ­veis Problemas

### Problema 1: "Syntax Error"
```
âŒ SoluÃ§Ã£o: Verificar se copiou TODO o arquivo
âœ… Copie desde "CREATE OR REPLACE FUNCTION..." 
   atÃ© "SELECT 'FunÃ§Ã£o...'" (Ãºltima linha)
```

### Problema 2: "Unknown Error"
```
âŒ Verificar:
   - EstÃ¡ no projeto correto?
   - Tem permissÃ£o de admin?
   - Banco nÃ£o estÃ¡ em manutenÃ§Ã£o?
âœ… Tente novamente em 2 minutos
```

### Problema 3: "Function already exists"
```
âœ… Isso Ã© NORMAL! CREATE OR REPLACE substitui.
âœ… Pode clicar [RUN] mÃºltiplas vezes.
```

---

## ğŸ“‹ Checklist

- [ ] Abri SQL Editor no Supabase
- [ ] Cliquei "+ New Query"
- [ ] Copiei TODO conteÃºdo de `fix_desconto_db.sql`
- [ ] Colei no editor
- [ ] Cliquei [RUN]
- [ ] Recebi mensagem de sucesso âœ…
- [ ] Executei a query de teste
- [ ] Vi desconto registrado na tabela

---

## ğŸ‰ Pronto!

Seu banco de dados agora registra desconto corretamente.

PrÃ³ximas faturas criadas terÃ£o:
- âœ… `faturas.desconto` preenchido
- âœ… `faturas.tipo_desconto` preenchido  
- âœ… `totais_fatura.desconto` calculado
- âœ… `totais_fatura.total_final` refletindo desconto

---

**Tempo total:** ~5 minutos
**Dificuldade:** â­ (muito fÃ¡cil)
**Impacto:** ğŸ¯ CorreÃ§Ã£o crÃ­tica de funcionalidade
